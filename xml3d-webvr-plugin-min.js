/*! xml3d-webvr-plugin.js v0.0.1 | (c) 2013-2016 DFKI GmbH and contributors, www.dfki.de | https://raw.githubusercontent.com/xml3d/xml3d.js/master/LICENSE */(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function onAnimationFrame(){if(gl.clear(gl.DEPTH_BUFFER_BIT),HMD){if(HMD.requestAnimationFrame(onAnimationFrame),HMD.isPresenting){var e=HMD.getPose(),r=e.orientation?e.orientation:[0,0,0,1],t=new XML3D.AxisAngle.fromQuat(new XML3D.Quat(r[0],r[1],r[2],r[3])),a=t.axis.x+" "+t.axis.y+" "+t.axis.z+" "+t.angle;$("#headTransform").attr("rotation",a);var s=e.position?e.position:[0,0,0],n=s[0]*scale+" "+s[1]*scale+" "+s[2]*scale;$("#headTransform").attr("translation",n),HMD.submitFrame(e)}}else HMD.requestAnimationFrame(onAnimationFrame)}function vrRenderTree(){console.log("creating custom tree"),console.log(XML3D);var e=HMD.getEyeParameters("left"),r=HMD.getEyeParameters("right"),t=e.offset,a=r.offset;$("#headTransformGroup").before('<transform id="headTransform"></transform>'),$("#headTransformGroup").attr("transform","#headTransform"),$("#eyeTransform").before('<transform id="leftEyeTransform" translation="'+t[0]*scale+" "+t[1]*scale+" "+t[2]*scale+'"></transform>'),$("#eyeTransform").before('<transform id="rightEyeTransform" translation="'+a[0]*scale+" "+a[1]*scale+" "+a[2]*scale+'"></transform>'),$("#eyeTransform").before('<transform id="defaultEyeTransform" translation="0 0 0"></transform>');var s=2*Math.max(e.renderWidth,r.renderWidth),n=Math.max(e.renderHeight,r.renderHeight);console.log("x: "+s+", y: "+n),XML3D.materials.register("vr-shader",{vertex:["attribute vec3 position;","void main(void) {","   gl_Position = vec4(position, 1.0);","}"].join("\n"),fragment:["uniform sampler2D leftTexture;","uniform sampler2D rightTexture;","uniform vec2 canvasSize;","void main(void) {","   float texX = (gl_FragCoord.x / canvasSize.x);","   vec2 texcoord;","   vec4 sum = vec4(0.0);","   if (texX < 0.5) {","   texcoord = (gl_FragCoord.xy / canvasSize.xy);","   sum += texture2D(leftTexture, vec2(texcoord.x, texcoord.y));","   }","   else{","   texcoord.x = (texX - 0.5);","   texcoord.y = (gl_FragCoord.y / canvasSize.y);","   sum += texture2D(rightTexture, vec2(texcoord.x, texcoord.y));","   }","    gl_FragColor = sum;","}"].join("\n"),uniforms:{canvasSize:[s,n]},samplers:{leftTexture:null,rightTexture:null}});var o=function(e,r,t){XML3D.webgl.BaseRenderPass.call(this,e,r,t),this.fullscreenQuad=e.createFullscreenQuad(),this.shaderProgram=e.getShaderProgram(t.shader)};XML3D.createClass(o,XML3D.webgl.BaseRenderPass),XML3D.extend(o.prototype,{render:function(e){var r=this.renderInterface.context.gl;this.output.bind(),this.shaderProgram.bind(),r.clear(r.COLOR_BUFFER_BIT),r.disable(r.DEPTH_TEST);var t={};t.canvasSize=[this.output.width,this.output.height],t.leftTexture=[this.inputs.leftTexture.colorTarget.handle],t.rightTexture=[this.inputs.rightTexture.colorTarget.handle],this.shaderProgram.setSystemUniformVariables(Object.keys(t),t),this.fullscreenQuad.draw(this.shaderProgram),this.shaderProgram.unbind(),this.output.unbind(),r.enable(r.DEPTH_TEST)},setProcessed:function(e){this.processed=e,this.prePasses[0].processed=e,this.prePasses[1].processed=e},renderTree:function(e){if(!this.processed){this.processed=!0;var r=this.prePasses.length;if(2==r){var t=this.prePasses[0],a=this.prePasses[1];$("#eyeTransform").attr("transform","#leftEyeTransform"),XML3D.flushDOMChanges(),a.renderTree(e),$("#eyeTransform").attr("transform","#rightEyeTransform"),XML3D.flushDOMChanges(),t.renderTree(e)}else for(;r--;)this.prePasses[r].renderTree(e);this.render(e)}}});var i=function(e){XML3D.webgl.BaseRenderTree.call(this,e),this.createRenderPasses()};XML3D.createClass(i,XML3D.webgl.BaseRenderTree),XML3D.extend(i.prototype,{createRenderPasses:function(){var e=this.renderInterface.context,r=this.renderInterface.createRenderTarget({width:e.canvasTarget.width,height:e.canvasTarget.height,colorFormat:e.gl.RGBA,depthFormat:e.gl.DEPTH_COMPONENT16,depthAsRenderbuffer:!0,stencilFormat:null}),t=this.renderInterface.createRenderTarget({width:e.canvasTarget.width,height:e.canvasTarget.height,colorFormat:e.gl.RGBA,depthFormat:e.gl.DEPTH_COMPONENT16,depthAsRenderbuffer:!0,stencilFormat:null}),a=this.renderInterface.createSceneRenderPass(r),s=this.renderInterface.createSceneRenderPass(t),n={inputs:{leftTexture:r,rightTexture:t},shader:"vr-shader",id:"vr"},i=new o(this.renderInterface,e.canvasTarget,n);i.addPrePass(s),i.addPrePass(a),this.mainRenderPass=i},render:function(e){this.mainRenderPass.setProcessed(!1),XML3D.webgl.BaseRenderTree.prototype.render.call(this,e)}});var d=document.getElementById("MyXml3d"),l=d.getRenderInterface(),c=new i(l);l.setRenderTree(c)}function initiateVR(){navigator.getVRDisplays().then(function(e){return e.length<1?void console.log("No VRDisplays found, reload page to try again"):(HMD=e[0],console.log(HMD),myCanvas=document.getElementsByClassName("_xml3d")[0],gl=myCanvas.getContext("webgl"),HMD.requestPresent([{source:myCanvas}]),vrRenderTree(),void onAnimationFrame())})}function resetPosition(){HMD&&HMD.resetPose()}$(document).ready(function(){document.getElementById("VRenable").addEventListener("click",function(){initiateVR()}),document.getElementById("ResetPos").addEventListener("click",function(){resetPosition()})});var HMD,gl,myCanvas,scale=10;
},{}]},{},[1]);
