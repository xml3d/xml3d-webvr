/*! xml3d-webvr-plugin.js v0.0.1 | (c) 2013-2016 DFKI GmbH and contributors, www.dfki.de | https://raw.githubusercontent.com/xml3d/xml3d.js/master/LICENSE */(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function fieldOfViewToProjectionMatrix(e,t,r){var a=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),n=Math.tan(e.leftDegrees*Math.PI/180),i=Math.tan(e.rightDegrees*Math.PI/180),f=2/(n+i),l=2/(a+o),d=new Float32Array(16);return d[0]=f,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=l,d[6]=0,d[7]=0,d[8]=-((n-i)*f*.5),d[9]=(a-o)*l*.5,d[10]=-(t+r)/(r-t),d[11]=-1,d[12]=0,d[13]=0,d[14]=-(2*r*t)/(r-t),d[15]=0,d}function arrayToString(e){for(var t="",r=0;r<e.length;r++)t=t+" "+e[r];return t}var fov=module.exports={};fov.setFOV=function(){var e,t,r;t=.01,r=100;var a=document.querySelector("view").getViewMatrix(),o=document.querySelector("xml3d").getWorldBoundingBox();o.transformAxisAligned(a),t=-o.max.z,r=-o.min.z,t=t<.01?.01:t,e=HMD.getEyeParameters("right").fieldOfView;var n=fieldOfViewToProjectionMatrix(e,t,r),i="<float4x4 name='projectionMatrix'>"+arrayToString(n)+"</float4x4>",f=$("view");$("#fovProjection");f.attr("model","urn:xml3d:view:projective"),f.append(i)};

},{}],2:[function(require,module,exports){
var render=module.exports={},fov=require("./fov.js"),scale=10,translationScale=3;render.vrRenderTree=function(){console.log("creating custom render tree");var e=HMD.getEyeParameters("left"),r=HMD.getEyeParameters("right"),s=e.offset,t=r.offset,a=$("#eyeTransform"),n=$("#headTransformGroup");n.before('<transform id="headTransform"></transform>'),n.attr("transform","#headTransform");var o=$("#headTransform");a.before('<transform id="leftEyeTransform" translation="'+s[0]*scale+" "+s[1]*scale+" "+s[2]*scale+'"></transform>'),a.before('<transform id="rightEyeTransform" translation="'+t[0]*scale+" "+t[1]*scale+" "+t[2]*scale+'"></transform>'),a.before('<transform id="defaultEyeTransform" translation="0 0 0"></transform>'),gl.canvas.width=2*Math.max(e.renderWidth,r.renderWidth),gl.canvas.height=Math.max(e.renderHeight,r.renderHeight),console.log("Canvas: "+gl.canvas.width+", "+gl.canvas.height),gl.enable(gl.SCISSOR_TEST);var i=function(e,r,s){XML3D.webgl.BaseRenderPass.call(this,e,r,s)};XML3D.createClass(i,XML3D.webgl.BaseRenderPass),XML3D.extend(i.prototype,{render:function(e){var r=this.renderInterface.context.gl;this.output.bind(),r.clear(r.COLOR_BUFFER_BIT),r.disable(r.DEPTH_TEST),this.output.unbind(),r.enable(r.DEPTH_TEST)},setProcessed:function(e){this.processed=e,this.prePasses[0].processed=e,this.prePasses[1].processed=e},renderTree:function(e){if(!this.processed){this.processed=!0;var r=HMD.getPose(),s=r.orientation?r.orientation:[0,0,0,1],t=new XML3D.AxisAngle.fromQuat(new XML3D.Quat(s[0],s[1],s[2],s[3])),n=t.axis.x+" "+t.axis.y+" "+t.axis.z+" "+t.angle;o.attr("rotation",n);var i=r.position?r.position:[0,0,0],d=i[0]*scale*translationScale+" "+i[1]*scale*translationScale+" "+i[2]*scale*translationScale;o.attr("translation",d),fov.setFOV();var l=HMD.getEyeParameters("left"),c=HMD.getEyeParameters("right"),f=this.prePasses.length;if(2==f){var h=this.prePasses[0],g=this.prePasses[1];a.attr("transform","#leftEyeTransform"),gl.scissor(0,0,l.renderWidth,l.renderHeight),gl.viewport(0,0,l.renderWidth,l.renderHeight),XML3D.flushDOMChanges(),g.render(e),a.attr("transform","#leftEyeTransform"),gl.scissor(l.renderWidth,0,c.renderWidth,c.renderHeight),gl.viewport(l.renderWidth,0,c.renderWidth,c.renderHeight),XML3D.flushDOMChanges(),h.render(e)}else for(;f--;)this.prePasses[f].renderTree(e);HMD.submitFrame(r)}}});var d=function(e){XML3D.webgl.BaseRenderTree.call(this,e),this.createRenderPasses()};XML3D.createClass(d,XML3D.webgl.BaseRenderTree),XML3D.extend(d.prototype,{createRenderPasses:function(){var e=this.renderInterface.context,r=function(){};e.canvasTarget.__proto__.bind=r;var s=this.renderInterface.createSceneRenderPass(),t=this.renderInterface.createSceneRenderPass(),a={},n=new i(this.renderInterface,e.canvasTarget,a);n.addPrePass(t),n.addPrePass(s),this.mainRenderPass=n},render:function(e){this.mainRenderPass.setProcessed(!1),XML3D.webgl.BaseRenderTree.prototype.render.call(this,e)}});var l=document.getElementsByTagName("xml3d")[0],c=l.getRenderInterface(),f=new d(c);c.setRenderTree(f),XML3D.options.setValue("renderer-continuous",!0)};

},{"./fov.js":1}],3:[function(require,module,exports){
(function (global){
function resetPosition(){HMD&&HMD.resetPose()}var utility=module.exports={},render=require("./render_viewports.js"),orig_requestAnimationFrame=window.requestAnimationFrame;utility.initiateVR=function(){navigator.getVRDisplays().then(function(e){if(e.length<1)return void console.log("No VRDisplays found, reload page to try again");HMD=e[0],console.log(HMD),myCanvas=document.getElementsByClassName("_xml3d")[0],gl=myCanvas.getContext("webgl");var t=HMD.getEyeParameters("left"),n=HMD.getEyeParameters("right");gl.canvas.width=2*Math.max(t.renderWidth,n.renderWidth),gl.canvas.height=Math.max(t.renderHeight,n.renderHeight),console.log("Canvas: "+gl.canvas.height+", "+gl.canvas.width),HMD.requestPresent([{source:myCanvas}]),render.vrRenderTree(),window.requestAnimationFrame=function(e){HMD.requestAnimationFrame(e)}})},utility.setupButtons=function(){var e={width:"10rem","border -width":"0px",cursor:"pointer","font-family":'"Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif',"font-weight":"normal","line-height":"normal",margin:"0 0 0rem",position:"relative","text-decoration":"none","text-align":"center",display:"inline-block","padding-top":"1rem","padding-right":"1rem","padding-bottom":"1rem","padding-left":"1rem","font-size":"1rem","background-color":"#008cba",color:"white",transition:"background-color 300ms ease-out"};$(".xml3d").first().before("<div id='ButtonBar' style='position: fixed; bottom: 0px'></div>"),utility.addVRenableBtn(e)};var $ResetPos=$("#ResetPos");utility.addVRenableBtn=function(e){var t=$("#VRenable"),n=$("#ButtonBar"),i=$("#ResetPos");n.append("<button id='VRenable'>Enter VR</button>"),t.css(e),document.getElementById("VRenable").addEventListener("click",function(){global.inVR?(t.html("Enter VR"),i.remove(),inVR=!1):(utility.initiateVR(),t.html("Exit VR"),utility.addResetBtn(e),inVR=!0)})},utility.addResetBtn=function(e){var t=$("#ButtonBar"),n=$("#ResetPos");t.append("<button id='ResetPos'>Reset Position</button>"),n.css(e),document.getElementById("ResetPos").addEventListener("click",function(){resetPosition()})};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./render_viewports.js":2}],4:[function(require,module,exports){
(function (global){
"use strict";var util=require("./utility.js");$(document).ready(function(){util.setupButtons()});var HMD,gl,myCanvas;global.inVR=!1;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./utility.js":3}]},{},[4]);
